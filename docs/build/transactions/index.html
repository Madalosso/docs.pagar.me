<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Pagar.me - Realizando uma transação</title>

    <link href="../stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="../javascripts/all.js"></script>

      <script>
        $(function() {
          setupLanguages(["shell","ruby","php"]);
        });
      </script>
  </head>

  <body class="transactions transactions_index">
    <div class="container header">
		<a href="https://pagar.me" style="float: left;"><img src="../images/logo.png" /></a>

	  <ul class="top-nav hidden-xs">
		  <li><a href="http://pagarme.zendesk.com/">Ajuda e Suporte</a></li>
		  <li class="button"><a href="https://dashboard.pagar.me">Entrar</a></li>
	  </ul>
    </div>
    <div class="container">

     


    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
              <a href="#" data-language-name="ruby">ruby</a>
              <a href="#" data-language-name="php">php</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="main-links-wrapper">
		  <a href="/">Início</a>
		  <a href="/capturing-card-data">Capturando os dados de cartão</a>
		  <a href="/transactions">Realizando uma transação</a>
		  <a href="/recipients">Gerenciando recebedores</a>
		  <a href="/checkout">Integração via checkout</a>
		  <a href="/cards">Cobrando um cartão posteriormente</a>
		  <a href="/plans-subscriptions">Planos e assinaturas</a>
		  <a href="/advanced">Opções avançadas</a>
		  <a href="https://pagar.me/docs/api" target="_blank">Referência completa da API</a>
      </div>
	  <div id="sidebar-footer">
		  <p>Não está encontrando o que procura? Envie um email para <a href="mailto:suporte@pagar.me">suporte@pagar.me</a>.
	  </div>
    </div>
    <div class="page-wrapper">
      <div class="content">
        <h1 id='realizando-uma-transacao'>Realizando uma transação</h1>
<p>Após <a href="/capturing-card-data">capturar os dados do cartão, gerar o <code class="prettyprint">card_hash</code> e enviá-lo para o seu
servidor</a>, você deve realizar a transação junto ao
Pagar.me, que efetuará a transação no cartão do cliente.</p>

<p>Para transações de boleto bancário, a transação pode ser realizada totalmente
dentro do seu servidor, já que não há a transmissão de dados sensíveis e
portanto o <code class="prettyprint">card_hash</code> não é utilizado.</p>

<p><strong>Atenção</strong>: após ser gerado, o <code class="prettyprint">card_hash</code> tem validade de 5 minutos e só pode ser utilizado uma única vez. Caso você deseje fazer diversas cobranças, cobranças posteriores, ou utilizar mais de uma feature (ex: transações + assinaturas), você deve primeiramente <a href="https://docs.pagar.me/cards/#storing-a-card">criar um <code class="prettyprint">card</code></a>.</p>
<h2 id='realizando-uma-transacao-de-cartao-de-credito-credit-card-transaction'>Realizando uma transação de cartão de crédito {#credit-card-transaction}</h1>
<p>Com o <code class="prettyprint">card_hash</code> no seu servidor, agora basta realizar a transação:</p>
<pre class="highlight shell"><code>curl -X POST <span class="s1">'https://api.pagar.me/1/transactions'</span> <span class="se">\</span>
    -d <span class="s1">'api_key=ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0'</span> <span class="se">\</span>
    -d <span class="s1">'amount=1000'</span> <span class="se">\</span>
    -d <span class="s1">'card_hash={CARD_HASH}'</span>
</code></pre>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'pagarme'</span>

<span class="no">PagarMe</span><span class="p">.</span><span class="nf">api_key</span> <span class="o">=</span> <span class="s2">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">;</span>

<span class="n">transaction</span> <span class="o">=</span> <span class="no">PagarMe</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span><span class="p">({</span>
    <span class="ss">:amount</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="ss">:card_hash</span> <span class="o">=&gt;</span> <span class="s2">"{CARD_HASH}"</span>
<span class="p">})</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">charge</span>

<span class="n">status</span> <span class="o">=</span> <span class="n">transaction</span><span class="p">.</span><span class="nf">status</span> <span class="c1"># status da transação</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
    <span class="k">require</span><span class="p">(</span><span class="s2">"pagarme-php/Pagarme.php"</span><span class="p">);</span>

    <span class="nx">Pagarme</span><span class="o">::</span><span class="na">setApiKey</span><span class="p">(</span><span class="s2">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">);</span>

    <span class="nv">$transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PagarMe_Transaction</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s1">'card_hash'</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="si">{</span><span class="nv">CARD_HASH</span><span class="si">}</span><span class="s2">"</span>
    <span class="p">));</span>

    <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">charge</span><span class="p">();</span>

    <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">status</span><span class="p">;</span> <span class="c1">// status da transação
</span><span class="cp">?&gt;</span>
</code></pre>
<pre class="highlight csharp"><code><span class="n">PagarMeService</span><span class="p">.</span><span class="n">DefaultApiKey</span> <span class="p">=</span> <span class="s">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">;</span>

<span class="n">Transaction</span> <span class="n">transaction</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Transaction</span><span class="p">();</span>

<span class="n">transaction</span><span class="p">.</span><span class="n">Amount</span> <span class="p">=</span> <span class="m">1000</span><span class="p">;</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">CardHash</span> <span class="p">=</span> <span class="s">"{CARD HASH}"</span><span class="p">;</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span>

<span class="n">TransactionStatus</span> <span class="n">status</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">.</span><span class="n">Status</span><span class="p">;</span>
</code></pre>

<blockquote>
<p>Não se esqueça de substituir <code class="prettyprint">ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0</code> pela
sua chave de API disponível no seu <a href="https://dashboard.pagar.me/">Dashboard</a>.</p>
</blockquote>

<p>Após realizar uma transação de cartão de crédito, a mesma terá status
<code class="prettyprint">paid</code>, indicando que o cartão do usuário foi debitado com sucesso.</p>

<p>Se a transação for recusada pelas operadoras de cartão, a mesma terá status
<code class="prettyprint">refused</code>.</p>

<p><aside class="notice">No ambiente de testes, você pode simular uma transação
recusada pela operadora de cartão passando um <code class="prettyprint">card_cvv</code> começando com
<code class="prettyprint">6</code>.</aside></p>
<h3 id='configuracoes-da-transacao'>Configurações da transação</h1>
<table><thead>
<tr>
<th>Tag</th>
<th>Padrão</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>&mdash;</td>
<td>Valor total a ser cobrado (em centavos). Ex: R$14,99 = <code class="prettyprint">1499</code></td>
</tr>
<tr>
<td>card_hash</td>
<td>&mdash;</td>
<td>Representação segura dos dados de cartão de crédito gerada pelo <code class="prettyprint">Pagarme.js</code></td>
</tr>
<tr>
<td>installments</td>
<td><code class="prettyprint">1</code></td>
<td>Número de parcelas a ser cobrado no cartão de crédito.</td>
</tr>
<tr>
<td>payment_method</td>
<td><code class="prettyprint">credit_card</code></td>
<td>Meio de pagamento a ser utilizado</td>
</tr>
<tr>
<td>postback_url</td>
<td>&mdash;</td>
<td>URL para receber notificações sobre alterações da transação (<a href="#postback">saiba mais</a>)</td>
</tr>
<tr>
<td>soft_descriptor</td>
<td>&mdash;</td>
<td>Texto (de até 13 caracteres) que será aparecerá na fatura do cartão do cliente ao lado do nome da sua loja</td>
</tr>
<tr>
<td>capture</td>
<td><code class="prettyprint">true</code></td>
<td>Passar <code class="prettyprint">false</code> para apenas autorizar a transação e realizar a captura posteriormente</td>
</tr>
</tbody></table>
<h2 id='realizando-uma-transacao-de-boleto-bancario-boleto-transaction'>Realizando uma transação de boleto bancário {#boleto-transaction}</h1>
<p>Uma transação de boleto bancária deve ser realizada diretamente do seu
servidor, sem a necessidade de utilizar o <code class="prettyprint">card_hash</code>, já que não há
transmissão de dados sensíveis para o seu servidor e para o Pagar.me.</p>
<pre class="highlight shell"><code>curl -X POST <span class="s1">'https://api.pagar.me/1/transactions'</span> <span class="se">\</span>
    -d <span class="s1">'api_key=ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0'</span> <span class="se">\</span>
    -d <span class="s1">'amount=1000'</span> <span class="se">\</span>
    -d <span class="s1">'payment_method=boleto'</span>
</code></pre>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'pagarme'</span>

<span class="no">PagarMe</span><span class="p">.</span><span class="nf">api_key</span> <span class="o">=</span> <span class="s2">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">;</span>

<span class="n">transaction</span> <span class="o">=</span> <span class="no">PagarMe</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span><span class="p">({</span>
    <span class="ss">:amount</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="ss">:payment_method</span> <span class="o">=&gt;</span> <span class="s2">"boleto"</span>
<span class="p">})</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">charge</span>

<span class="n">boleto_url</span> <span class="o">=</span> <span class="n">transaction</span><span class="p">.</span><span class="nf">boleto_url</span> <span class="c1"># URL do boleto bancário</span>
<span class="n">boleto_barcode</span> <span class="o">=</span> <span class="n">transaction</span><span class="p">.</span><span class="nf">boleto_barcode</span> <span class="c1"># código de barras do boleto bancário</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
    <span class="k">require</span><span class="p">(</span><span class="s2">"pagarme-php/Pagarme.php"</span><span class="p">);</span>

    <span class="nx">Pagarme</span><span class="o">::</span><span class="na">setApiKey</span><span class="p">(</span><span class="s2">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">);</span>

    <span class="nv">$transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PagarMe_Transaction</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s1">'payment_method'</span> <span class="o">=&gt;</span> <span class="s2">"boleto"</span>
    <span class="p">));</span>

    <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">charge</span><span class="p">();</span>

    <span class="nv">$boleto_url</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">boleto_url</span><span class="p">;</span> <span class="c1">// URL do boleto bancário
</span>    <span class="nv">$boleto_barcode</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">boleto_barcode</span><span class="p">;</span> <span class="c1">// código de barras do boleto bancário
</span><span class="cp">?&gt;</span>
</code></pre>
<pre class="highlight csharp"><code><span class="n">PagarMeService</span><span class="p">.</span><span class="n">DefaultApiKey</span> <span class="p">=</span> <span class="s">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">;</span>

<span class="n">Transaction</span> <span class="n">transaction</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Transaction</span><span class="p">();</span>

<span class="n">transaction</span><span class="p">.</span><span class="n">Amount</span> <span class="p">=</span> <span class="m">1000</span><span class="p">;</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">PaymentMethod</span> <span class="p">=</span> <span class="n">PaymentMethod</span><span class="p">.</span><span class="n">Boleto</span><span class="p">;</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span>

<span class="kt">string</span> <span class="n">boletoUrl</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">.</span><span class="n">BoletoUrl</span><span class="p">;</span>
<span class="kt">string</span> <span class="n">boletoBarcode</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">.</span><span class="n">BoletoBarcode</span><span class="p">;</span>
</code></pre>

<blockquote>
<p>Não se esqueça de substituir <code class="prettyprint">ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0</code> pela
sua chave de API disponível no seu <a href="https://dashboard.pagar.me/">Dashboard</a>.</p>
</blockquote>

<p>A transação terá status <code class="prettyprint">waiting_payment</code> até o pagamento do boleto
bancário. A URL do boleto bancário para pagamento estará disponível na variável
<code class="prettyprint">boleto_url</code>.</p>

<p>Quando o boleto bancário for detectado como pago, a transação passará a ter o
status <code class="prettyprint">paid</code>.</p>
<h3 id='configuracoes-da-transacao'>Configurações da transação</h1>
<table><thead>
<tr>
<th>Tag</th>
<th>Padrão</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>&mdash;</td>
<td>Valor total a ser cobrado (em centavos). Ex: R$14,99 = <code class="prettyprint">1499</code></td>
</tr>
<tr>
<td>payment_method</td>
<td><code class="prettyprint">boleto</code></td>
<td>Meio de pagamento a ser utilizado</td>
</tr>
<tr>
<td>postback_url</td>
<td>&mdash;</td>
<td>URL para receber notificações sobre alterações da transação (<a href="#postback">saiba mais</a>)</td>
</tr>
<tr>
<td>boleto_expiration_date</td>
<td>data atual + 7 dias</td>
<td>Data de vencimento do boleto bancário</td>
</tr>
</tbody></table>
<h2 id='recebendo-notificacoes-de-mudanca-de-status-da-transacao-postback-postback'>Recebendo notificações de mudança de status da transação (POSTback) {#postback}</h1>
<p>Ao realizar uma transação, diversos serviços externos (como empresas de
antifraude, operadoras de cartão e bancos) são consultados. Por isso, esse
processo pode demorar um pouco mais do que uma requisição HTTP normal, que
costuma durar menos de um segundo.</p>

<p>Para evitar que o tempo de resposta da requisição prejudique sua aplicação, ao
criar uma transação, você pode fornecer uma <code class="prettyprint">postback_url</code>. Dessa forma, quando
a transação mudar de status, o Pagar.me notificará sua aplicação e o fluxo de
compra pode ser finalizado.</p>

<p>As URLs de POSTback também são úteis ao criar transações de boleto bancário.
Dessa forma, quando o pagamento do boleto for detectado junto ao banco, sua
aplicação será notificada e o fluxo de compra pode ser finalizado.</p>

<p>Caso a transação seja estornada, a URL de POSTback também será notificada sobre
a mudança de status.</p>
<pre class="highlight shell"><code>curl -X POST <span class="s1">'https://api.pagar.me/1/transactions'</span> <span class="se">\</span>
    -d <span class="s1">'api_key=ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0'</span> <span class="se">\</span>
    -d <span class="s1">'amount=1000'</span> <span class="se">\</span>
    -d <span class="s1">'card_hash={CARD_HASH}'</span> <span class="se">\</span>
    -d <span class="s1">'postback_url=http://seusite.com/payments/2718'</span>
</code></pre>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'pagarme'</span>

<span class="no">PagarMe</span><span class="p">.</span><span class="nf">api_key</span> <span class="o">=</span> <span class="s2">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">;</span>

<span class="n">transaction</span> <span class="o">=</span> <span class="no">PagarMe</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span><span class="p">({</span>
    <span class="ss">:amount</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="ss">:card_hash</span> <span class="o">=&gt;</span> <span class="s2">"{CARD_HASH}"</span><span class="p">,</span>
    <span class="ss">:postback_url</span> <span class="o">=&gt;</span> <span class="s2">"http://seusite.com/payments/2718"</span>
<span class="p">})</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">charge</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
    <span class="k">require</span><span class="p">(</span><span class="s2">"pagarme-php/Pagarme.php"</span><span class="p">);</span>

    <span class="nx">Pagarme</span><span class="o">::</span><span class="na">setApiKey</span><span class="p">(</span><span class="s2">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">);</span>

    <span class="nv">$transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PagarMe_Transaction</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s1">'card_hash'</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="si">{</span><span class="nv">CARD_HASH</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
        <span class="s1">'postback_url'</span> <span class="o">=&gt;</span> <span class="s2">"http://seusite.com/payments/2718"</span>
    <span class="p">));</span>

    <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">charge</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre>
<pre class="highlight csharp"><code><span class="n">PagarMeService</span><span class="p">.</span><span class="n">DefaultApiKey</span> <span class="p">=</span> <span class="s">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">;</span>

<span class="n">Transaction</span> <span class="n">transaction</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Transaction</span><span class="p">();</span>

<span class="n">transaction</span><span class="p">.</span><span class="n">Amount</span> <span class="p">=</span> <span class="m">1000</span><span class="p">;</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">CardHash</span> <span class="p">=</span> <span class="s">"{CARD HASH}"</span><span class="p">;</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">PostbackUrl</span> <span class="p">=</span> <span class="s">"http://seusite.com/payments/2718"</span><span class="p">;</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span>
</code></pre>

<blockquote>
<p>Não se esqueça de substituir <code class="prettyprint">ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0</code> pela
sua chave de API disponível no seu <a href="https://dashboard.pagar.me/">Dashboard</a>.</p>
</blockquote>

<p><aside class="notice">Você pode utilizar o serviço
<a href="http://requestb.in">RequestBin</a> para gerar URLs de POSTback de teste e
visualizar as requisições enviadas pelo Pagar.me.</aside></p>

<p>Quando a <code class="prettyprint">postback_url</code> é passada, a transação será retornada com status
<code class="prettyprint">processing</code>, e as mudanças de status serão enviadas para o seu servidor na URL
de POSTback, através de um request <code class="prettyprint">HTTP POST</code> com os seguintes parâmetros:</p>

<table><thead>
<tr>
<th>Parâmetro</th>
<th>Descrição</th>
<th>Valor padrão</th>
</tr>
</thead><tbody>
<tr>
<td>object</td>
<td>Objeto que originou a notificação de POSTback</td>
<td><code class="prettyprint">transaction</code></td>
</tr>
<tr>
<td>id</td>
<td>ID do objeto (transação) que originou a notificação de POSTback</td>
<td>&mdash;</td>
</tr>
<tr>
<td>event</td>
<td>Evento que originou a notificação de POSTback</td>
<td><code class="prettyprint">transaction_status_changed</code></td>
</tr>
<tr>
<td>current_status</td>
<td>Status da transação após o evento</td>
<td>&mdash;</td>
</tr>
<tr>
<td>old_status</td>
<td>Status da transação antes do evento</td>
<td>&mdash;</td>
</tr>
<tr>
<td>desired_status</td>
<td>Status desejado após o evento</td>
<td>Ao criar a transação: <code class="prettyprint">paid</code>. Ao estornar a transação: <code class="prettyprint">refunded</code></td>
</tr>
<tr>
<td>fingerprint</td>
<td>Parâmetro usado para validar a notificação de POSTback (<a href="/advanced#validando-a-origem-de-um-postback">saiba mais</a>)</td>
<td>&mdash;</td>
</tr>
</tbody></table>
<h2 id='dividindo-uma-transacao-split'>Dividindo uma transação {#split}</h1>
<p>Ao criar uma transação, você poderá definir quem irá receber e quanto do valor referente a esta transação será recebido. Essas regras são definidas através das <code class="prettyprint">split_rules</code>, ou <strong>regras de split</strong>.</p>

<p>Para criar uma regra de divisão, você precisa primeiro <a href="/recipients">criar um recebedor</a>.</p>

<p>Após criado seus recebedores, você deve adicionar os parâmetros <code class="prettyprint">split_rules</code> na hora de criar a transação, como no exemplo seguinte:</p>
<pre class="highlight shell"><code>curl -X POST <span class="s1">'https://api.pagar.me/1/transactions'</span> <span class="se">\</span>
    -d <span class="s1">'api_key=ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0'</span> <span class="se">\</span>
    -d <span class="s1">'amount=1000'</span> <span class="se">\</span>
    -d <span class="s1">'card_hash={CARD_HASH}'</span> <span class="se">\</span>
    -d <span class="s1">'postback_url=http://seusite.com/payments/2718'</span> <span class="se">\</span>
    -d <span class="s1">'split_rules[0][recipient_id]=re_ci7nhf1ay0007n016wd5t22nl'</span>
    -d <span class="s1">'split_rules[0][charge_processing_fee]=true'</span> <span class="se">\</span>
    -d <span class="s1">'split_rules[0][liable]=true'</span> <span class="se">\</span>
    -d <span class="s1">'split_rules[0][percentage]=30'</span> <span class="se">\</span>
    -d <span class="s1">'split_rules[1][recipient_id]=re_ci7nheu0m0006n016o5sglg9t'</span> <span class="se">\</span>
    -d <span class="s1">'split_rules[1][charge_processing_fee]=true'</span> <span class="se">\</span>
    -d <span class="s1">'split_rules[1][liable]=false'</span> <span class="se">\</span>
    -d <span class="s1">'split_rules[1][percentage]=70'</span>
</code></pre>
<pre class="highlight ruby"><code></code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
    <span class="k">require</span><span class="p">(</span><span class="s2">"pagarme-php/Pagarme.php"</span><span class="p">);</span>

    <span class="nx">Pagarme</span><span class="o">::</span><span class="na">setApiKey</span><span class="p">(</span><span class="s2">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">);</span>

    <span class="nv">$transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PagarMe_Transaction</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s1">'card_hash'</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="si">{</span><span class="nv">CARD_HASH</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
        <span class="s1">'split_rules'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s1">'recipient_id'</span> <span class="o">=&gt;</span> <span class="s1">'re_ci7nheu0m0006n016o5sglg9t'</span><span class="p">,</span>
            <span class="s1">'charge_processing_fee'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
            <span class="s1">'liable'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
            <span class="s1">'percentage'</span> <span class="o">=&gt;</span> <span class="s1">'60'</span><span class="p">,</span>

        <span class="p">),</span>

        <span class="k">array</span><span class="p">(</span>
            <span class="s1">'recipient_id'</span> <span class="o">=&gt;</span> <span class="s1">'re_ci7nhf1ay0007n016wd5t22nl'</span><span class="p">,</span>
            <span class="s1">'charge_processing_fee'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
            <span class="s1">'liable'</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
            <span class="s1">'percentage'</span> <span class="o">=&gt;</span> <span class="s1">'40'</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">));</span>

    <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">charge</span><span class="p">();</span>

    <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">status</span><span class="p">;</span> <span class="c1">// status da transação
</span><span class="cp">?&gt;</span>
</code></pre>
<pre class="highlight csharp"><code></code></pre>

<blockquote>
<p>Não se esqueça de substituir <code class="prettyprint">ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0</code> pela
sua chave de API disponível no seu <a href="https://dashboard.pagar.me/">Dashboard</a>.</p>
</blockquote>
<h2 id='enviando-dados-do-cliente-para-o-pagar-me-antifraude-customer-data'>Enviando dados do cliente para o Pagar.me (antifraude) {#customer-data}</h1>
<p>Para ter um maior controle dos seus clientes, principalmente através do
Dashboard do Pagar.me, recomendamos que você também envie os dados do cliente
ao realizar a transação.</p>

<p>Para utilizar o recurso antifraude, é obrigatório o envio
dos dados do cliente para o Pagar.me.</p>

<p><aside class="notice">No ambiente de testes, você pode simular uma transação
recusada pelo antifraude passando o <code class="prettyprint">customer[document_number]</code> como
<code class="prettyprint">11111111111</code>.</aside></p>
<pre class="highlight shell"><code>curl -X POST <span class="s1">'https://api.pagar.me/1/transactions'</span> <span class="se">\</span>
    -d <span class="s1">'api_key=ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0'</span> <span class="se">\</span>
    -d <span class="s1">'amount=1000'</span> <span class="se">\</span>
    -d <span class="s1">'card_hash={CARD_HASH}'</span> <span class="se">\</span>
    -d <span class="s1">'customer[name]=John Appleseed'</span> <span class="se">\</span>
    -d <span class="s1">'customer[document_number]=92545278157'</span> <span class="se">\</span>
    -d <span class="s1">'customer[email]=jappleseed@apple.com'</span> <span class="se">\</span>
    -d <span class="s1">'customer[address][street]=Av. Brigadeiro Faria Lima'</span> <span class="se">\</span>
    -d <span class="s1">'customer[address][neighborhood]=Jardim Paulistano'</span> <span class="se">\</span>
    -d <span class="s1">'customer[address][zipcode]=01452000'</span> <span class="se">\</span>
    -d <span class="s1">'customer[address][street_number]=2941'</span> <span class="se">\</span>
    -d <span class="s1">'customer[address][complementary]=8º andar'</span> <span class="se">\</span>
    -d <span class="s1">'customer[phone][ddd]=11'</span> <span class="se">\</span>
    -d <span class="s1">'customer[phone][number]=30713261'</span> <span class="se">\</span>
</code></pre>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'pagarme'</span>

<span class="no">PagarMe</span><span class="p">.</span><span class="nf">api_key</span> <span class="o">=</span> <span class="s2">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">;</span>

<span class="n">transaction</span> <span class="o">=</span> <span class="no">PagarMe</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">new</span><span class="p">({</span>
    <span class="ss">:amount</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="ss">:card_hash</span> <span class="o">=&gt;</span> <span class="s2">"{CARD_HASH}"</span><span class="p">,</span>
    <span class="ss">:customer</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"John Appleseed"</span><span class="p">,</span>
        <span class="ss">:document_number</span> <span class="o">=&gt;</span> <span class="s2">"92545278157"</span><span class="p">,</span>
        <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">"jappleseed@apple.com"</span><span class="p">,</span>
        <span class="ss">:address</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="ss">:street</span> <span class="o">=&gt;</span> <span class="s2">"Av. Brigadeiro Faria Lima"</span><span class="p">,</span>
            <span class="ss">:neighborhood</span> <span class="o">=&gt;</span> <span class="s2">"Jardim Paulistano"</span><span class="p">,</span>
            <span class="ss">:zipcode</span> <span class="o">=&gt;</span> <span class="s2">"01452000"</span><span class="p">,</span>
            <span class="ss">:street_number</span> <span class="o">=&gt;</span> <span class="s2">"2941"</span><span class="p">,</span>
            <span class="ss">:complementary</span> <span class="o">=&gt;</span> <span class="s2">"8º andar"</span>
        <span class="p">},</span>
        <span class="ss">:phone</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="ss">:ddd</span> <span class="o">=&gt;</span> <span class="s2">"11"</span>
            <span class="ss">:number</span> <span class="o">=&gt;</span> <span class="s2">"30713261"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">charge</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
    <span class="k">require</span><span class="p">(</span><span class="s2">"pagarme-php/Pagarme.php"</span><span class="p">);</span>

    <span class="nx">Pagarme</span><span class="o">::</span><span class="na">setApiKey</span><span class="p">(</span><span class="s2">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">);</span>

    <span class="nv">$transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PagarMe_Transaction</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s2">"amount"</span> <span class="o">=&gt;</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">"card_hash"</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="si">{</span><span class="nv">CARD_HASH</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"customer"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"John Appleseed"</span><span class="p">,</span>
            <span class="s2">"document_number"</span> <span class="o">=&gt;</span> <span class="s2">"92545278157"</span><span class="p">,</span>
            <span class="s2">"email"</span> <span class="o">=&gt;</span> <span class="s2">"jappleseed@apple.com"</span><span class="p">,</span>
            <span class="s2">"address"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s2">"street"</span> <span class="o">=&gt;</span> <span class="s2">"Av. Brigadeiro Faria Lima"</span><span class="p">,</span>
                <span class="s2">"neighborhood"</span> <span class="o">=&gt;</span> <span class="s2">"Jardim Paulistano"</span><span class="p">,</span>
                <span class="s2">"zipcode"</span> <span class="o">=&gt;</span> <span class="s2">"01452000"</span><span class="p">,</span>
                <span class="s2">"street_number"</span> <span class="o">=&gt;</span> <span class="s2">"2941"</span><span class="p">,</span>
                <span class="s2">"complementary"</span> <span class="o">=&gt;</span> <span class="s2">"8º andar"</span>
            <span class="p">),</span>
            <span class="s2">"phone"</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s2">"ddd"</span> <span class="o">=&gt;</span> <span class="s2">"11"</span><span class="p">,</span>
                <span class="s2">"number"</span> <span class="o">=&gt;</span> <span class="s2">"30713261"</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">));</span>

    <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">charge</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre>
<pre class="highlight csharp"><code><span class="n">PagarMeService</span><span class="p">.</span><span class="n">DefaultApiKey</span> <span class="p">=</span> <span class="s">"ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0"</span><span class="p">;</span>

<span class="n">Transaction</span> <span class="n">transaction</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Transaction</span><span class="p">();</span>

<span class="n">transaction</span><span class="p">.</span><span class="n">Amount</span> <span class="p">=</span> <span class="m">1000</span><span class="p">;</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">CardHash</span> <span class="p">=</span> <span class="s">"{CARD HASH}"</span><span class="p">;</span>
<span class="n">transaction</span><span class="p">.</span><span class="n">Customer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Customer</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Name</span> <span class="p">=</span> <span class="s">"John Appleseed"</span><span class="p">,</span>
    <span class="n">DocumentNumber</span> <span class="p">=</span> <span class="s">"92545278157"</span><span class="p">,</span>
    <span class="n">Email</span> <span class="p">=</span> <span class="s">"jappleseed@apple.com"</span><span class="p">,</span>
    <span class="n">Address</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Address</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Street</span> <span class="p">=</span> <span class="s">"Av. Brigadeiro Faria Lima"</span><span class="p">,</span>
        <span class="n">Neighborhood</span> <span class="p">=</span> <span class="s">"Jardim Paulistano"</span><span class="p">,</span>
        <span class="n">Zipcode</span> <span class="p">=</span> <span class="s">"01452000"</span><span class="p">,</span>
        <span class="n">StreetNumber</span> <span class="p">=</span> <span class="s">"2941"</span><span class="p">,</span>
        <span class="n">Complementary</span> <span class="p">=</span> <span class="s">"8º andar"</span>
    <span class="p">},</span>
    <span class="n">Phone</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Phone</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Ddd</span> <span class="p">=&gt;</span> <span class="s">"11"</span><span class="p">,</span>
        <span class="n">Number</span> <span class="p">=&gt;</span> <span class="s">"30713261"</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span>
</code></pre>

<blockquote>
<p>Não se esqueça de substituir <code class="prettyprint">ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0</code> pela
sua chave de API disponível no seu <a href="https://dashboard.pagar.me/">Dashboard</a>.</p>
</blockquote>
<h2 id='cancelando-uma-transacao-refund'>Cancelando uma Transação {#refund}</h1>
<p>Para cancelar uma transação, ou seja, fazer um estorno, você deve enviar uma requisição <code class="prettyprint">POST</code> para a rota <code class="prettyprint">/transactions/:id/refund</code>, onde <code class="prettyprint">:id</code> é o <code class="prettyprint">id</code> da transação.</p>
<pre class="highlight shell"><code>curl -X POST <span class="s1">'https://api.pagar.me/1/transactions/:id/refund'</span> <span class="se">\</span>
    -d <span class="s1">'api_key=ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0'</span>
</code></pre>
<pre class="highlight ruby"><code><span class="n">transaction</span> <span class="o">=</span> <span class="no">PagarMe</span><span class="o">::</span><span class="no">Transaction</span><span class="p">.</span><span class="nf">find_by_id</span><span class="p">(</span><span class="s2">"{ID}"</span><span class="p">)</span>
<span class="n">transaction</span><span class="p">.</span><span class="nf">refund</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">status</span>
<span class="c1"># refunded</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="nv">$transaction</span> <span class="o">=</span> <span class="nx">PagarMe_Transaction</span><span class="o">::</span><span class="na">findById</span><span class="p">(</span><span class="s2">"</span><span class="si">{</span><span class="nv">ID</span><span class="si">}</span><span class="s2">"</span><span class="p">);</span>
<span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">refund</span><span class="p">();</span>

<span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">getStatus</span><span class="p">();</span>
<span class="c1">// "refunded"
</span>
<span class="cp">?&gt;</span>
</code></pre>
<pre class="highlight csharp"><code><span class="n">var</span> <span class="n">transaction</span> <span class="p">=</span> <span class="n">PagarMeService</span><span class="p">.</span><span class="nf">GetDefaultService</span><span class="p">().</span><span class="n">Transactions</span><span class="p">.</span><span class="nf">Find</span><span class="p">();</span>

<span class="n">transaction</span><span class="p">.</span><span class="nf">Refund</span><span class="p">();</span>

<span class="n">TransactionStatus</span> <span class="n">status</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">.</span><span class="n">Status</span><span class="p">;</span>
<span class="c1">// TransactionStatus.Refunded
</span></code></pre>

<blockquote>
<p>Não se esqueça de substituir <code class="prettyprint">ak_test_grXijQ4GicOa2BLGZrDRTR5qNQxJW0</code> pela
sua chave de API disponível no seu <a href="https://dashboard.pagar.me/">Dashboard</a>.</p>
</blockquote>

      </div>

    </div>
    <div class="clear"></div>
  </div>
  </body>
</html>
